facebook 用于存储图片的系统
 
主要设计点
 
1.
 
    系统主要分为三块
    
    Directory(相当于manager，维护图片获取url地址到物理地址的映射，以及对于物理机器的管理和维护）
    cache 层（负责缓存图片数据）
    store层（负责存储图片）
 
2. 
 
    将许多小的图片文件合并成一个大文件，存储在文件系统中。并且此系统底层用xfs文件系统，xfs是
    64位的文件系统，能够支持2^64文件大小（大约为 1EB = 1024PB,1PB=1024TB,1TB=1024GB)，此
    文件系统一个journey based system,是由SGI公司开发的。
 
3.
 
    为了能够快速的定位图片在这一个大文件中的位置，此系统会在内存中存储一个map数据结构，根据
    图片id映射到文件以及在相应文件中的偏移量。并且为了在重启时候能够快速重建此map结构，会根据大
    文件来做一个index file，加速重启时候速度。
 
 
    basho做的bitcask的思路以及douban的beansdb的思路与此类似，可以参照这些项目的代码学习
    
    关于将图片id映射到某个日志文件的算法，
    1.consistent hashing 
    2. map 数据结构，不做改变的数据结构。
 
 
 
 
 
  卡夫卡消息队列设计方法
   1.为了提高并行度，将一个topic分成多个partion
   2.提高吞吐量，消息分发和消耗时做batch的操作
   3.提高分区log磁盘写效率，做bulk write
   4.传输量 做压缩。
